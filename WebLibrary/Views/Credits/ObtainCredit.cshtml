@model WebLibrary.Models.CreditViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row mx-0 mt-4 justify-content-center">
    <div class="col-8 py-4 jumbotron visibility3">
        <h2 class="text-center">The best credits on the market</h2>
        <hr />
        @if (ViewBag.Message != null)
        {
            <div class="row">
                <div class="col">
                    <div class="alert alert-danger" role="alert">
                        @ViewBag.Message
                    </div>
                </div>
            </div>
        }
        <div class="row mx-0">
            <div class="col">
                <h3 class="text-center">Customer confidence</h3>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
                Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
            </div>

            <div class="col">
                <h3 class="text-center">Obtain a credit</h3>
                @using (Html.BeginForm())
                {
                    @Html.AntiForgeryToken()
                    @Html.TextBoxFor(m => m.CreditAmount, new { @class = "form-control" });
                    <label>Credit period</label>
                    <input type="range" id="periodYearsInput" name="CreditPeriodInYears" class="form-control-range" min="1" max="10" />
                    <label id="periodYearsValue"></label>
                    <button type="submit" class="btn btn-primary btn-block">Obtain</button>
                }

            </div>
        </div>
        <hr />
        <div class="row justify-content-center">
            <div class="col">
                <p class="text-center">
                    Not sure about credit conditions? Use our calculator and customize them to your needs!<br />
                    <button type="button" class="btn btn-primary mt-3" data-toggle="modal" data-target="#calculatorModal">Open calculator</button>
                </p>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="calculatorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Credit calculator</h5>
                <button type="button" class="close text-danger" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="input-group">
                        <input type="text" id="creditAmount" placeholder="Credit Amount" class="form-control" />
                        <div class="input-group-append">
                            <span class="input-group-text">PLN</span>
                        </div>
                        <div class="invalid-feedback">
                            Please provide a valid credit amount.
                        </div>
                    </div>

                    <div class="input-group my-3">
                        <input type="text" id="percentageRate" placeholder="Percentage rate" class="form-control" />
                        <div class="input-group-append">
                            <span class="input-group-text">%</span>
                        </div>
                        <div class="invalid-feedback">
                            Please provide a valid rate.
                        </div>
                    </div>

                    <div class="input-group my-3">
                        <label>Credit period</label>
                        <input type="range" class="custom-range" id="creditPeriod" min="1" max="20" step="1" />
                        <label id="creditPeriodInfo">year(s)</label>
                    </div>
                    <button type="button" id="calculate" class="btn btn-primary btn-block">Calculate</button>
                </form>
                <hr />
                <div class="alert alert-success text-center">
                    <span id="installmentCount" class="font-weight-bold"></span>
                    total installments
                    <span id="installmentAmount" class="font-weight-bold"></span> PLN each. <br />
                    <span id="totalMoney" class="font-weight-bold"></span> PLN in total.

                </div>
            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

@section scripts
{

    <script>
        $(document).ready(function () {

            (function ($) {
                $.fn.inputFilter = function (inputFilter) {
                    return this.on("input keydown keyup mousedown mouseup select contextmenu drop", function () {
                        if (inputFilter(this.value)) {
                            this.oldValue = this.value;
                            this.oldSelectionStart = this.selectionStart;
                            this.oldSelectionEnd = this.selectionEnd;
                        } else if (this.hasOwnProperty("oldValue")) {
                            this.value = this.oldValue;
                            this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                        }
                    });
                };
            }(jQuery));

            var getYearSpelling = function (value) {
                if (value == 1)
                    return " year";
                else
                    return " years";
            };

            (function () {
                var currentPeriod = $("#periodYearsInput").val();
                $("#periodYearsValue").html(currentPeriod + getYearSpelling(currentPeriod));

                $("#periodYearsInput").on("input", function () {
                    var creditPeriod = $(this).val();
                    $("#periodYearsValue").html(creditPeriod + getYearSpelling(creditPeriod));
                });
            })();


            //initializing stuff...
            (function () {
                $(".alert").hide();

                var currentPeriod = $("#creditPeriod").val();
                $("#creditPeriodInfo").html(currentPeriod + getYearSpelling(currentPeriod));

                $("#creditAmount").inputFilter(function (value) {
                    return /^\d*$/.test(value);
                });

                $("#percentageRate").inputFilter(function (value) {
                    return /^-?\d*[.,]?\d{0,2}$/.test(value);
                });

                $("#creditPeriod").on("input", function () {
                    var creditPeriod = $(this).val();
                    $("#creditPeriodInfo").html(creditPeriod + getYearSpelling(creditPeriod));
                });

                $("input").on("input", function () {
                    $(".alert").slideUp();
                });
            })();
        });
    </script>

}