@model WebLibrary.Models.UserInfoViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="accountInfoModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Account's statistics</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" class="text-danger">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col">
                        <div class="alert alert-danger text-center">
                            You've made
                            <span class="font-weight-bold" id="js-transfers-sent"></span>
                            transfers, <br />sending
                            <span class="font-weight-bold" id="js-total-money-sent"></span>
                            PLN in total.
                        </div>
                    </div>

                    <div class="col">
                        <div class="alert alert-success text-center">
                            You've been sent
                            <span class="font-weight-bold" id="js-transfers-received"></span>
                            transfers, <br />receiving
                            <span class="font-weight-bold" id="js-total-money-received"></span>
                            PLN in total.
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <canvas id="js-transfer-chart" width="400" height="400"></canvas>
                </div>

            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    @*Account's info*@
    <div class="col-4 px-2">
        <div class="container h-100 jumbotron px-4 mb-0 visibility3">
            <div class="row mb-3">
                <div class="col">
                    <div class=@Model.IconClass></div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <h2>@Model.UserFirstName @Model.UserLastName</h2>
                </div>
            </div>
            <hr />
            <div class="row my-3 mx-0">
                <div class="col px-0">
                    <h4><span class="float-left">Account type:</span></h4>
                </div>
                <div class="col px-0">
                    <h4><span class="float-right">@Model.BankAccount.BankAccountType</span></h4>
                </div>
            </div>

            <div class="row my-3 mx-0">
                <div class="col px-0">
                    <h4><span class="float-left">Balance:</span></h4>
                </div>
                <div class="col px-0">
                    <h4><span class="float-right">@Model.BankAccount.Cash PLN</span></h4>
                </div>
            </div>

            <div class="row my-3 mx-0">
                <div class="col px-0">
                    <span class="float-left">Account's ID</span>
                </div>
                <div class="col px-0">
                    <span class="float-right">@Model.BankAccount.Id</span>
                </div>
            </div>
            <div class="row my-3 mx-0">
                <div class="col px-0">
                    <span class="float-left">Loans taken:</span>
                </div>
                <div class="col px-0">
                    <span class="float-right">1</span>
                </div>
            </div>

            <div class="row my-3 mx-0">
                <div class="col px-0">
                    <span class="float-left">Investments:</span>
                </div>
                <div class="col px-0">
                    <span class="float-right">2</span>
                </div>
            </div>

            <hr />
            <div class="row mx-0 justify-content-end">
                <a href="#" data-toggle="modal" data-target="#accountInfoModal">See more...</a>
            </div>


        </div>

    </div>

    @*Loans info*@
    <div class="col-8 px-0">
        <div class="container d-flex h-100 flex-column mb-0 pb-0">
            <div class="container jumbotron px-4 pb-3 mb-3 mt-auto visibility3 flex-grow-1">
                <h2>Your current loans</h2>
                <hr />
                <div class="row my-3 mx-0">
                    <div class="col px-0">
                        <span class="float-left">Credit amount: 5000 PLN</span>
                    </div>
                    <div class="col px-0">
                        <span class="float-right">Installments: 60 (25 left)</span>
                    </div>
                </div>
                <div class="row">
                    <div class="col progress">
                        <div class="progress-bar bg-success h-25" style="width:58%" role="progressbar" aria-valuenow="35" aria-valuemin="0" aria-valuemax="60"></div>
                    </div>
                </div>
                <hr />
                <div class="row mx-0 justify-content-end"><a href="#">See more...</a></div>
            </div>

            @*Investments info*@
            <div class="container jumbotron px-4 pb-3 mt-2 mb-auto visibility3 flex-grow-1">
                <h2>Your investments</h2>
                <hr />
                <div class="row my-3 mx-0">
                    <div class="col px-0">
                        <span class="float-left">Name of the investment fund</span>
                    </div>
                    <div class="col px-0">
                        <span class="float-right">Current value: 7312 PLN</span>
                    </div>


                </div>

                <div class="row my-3 mx-0">
                    <div class="col px-0">
                        <span class="float-left">Name of the another investment fund</span>
                    </div>
                    <div class="col px-0">
                        <span class="float-right">Current value: 5075 PLN</span>
                    </div>
                </div>

                <hr />
                <div class="row mx-0 justify-content-end"><a href="#">See more...</a></div>
            </div>
        </div>
    </div>
</div>

@section scripts
{
    <script type="text/javascript" src="~/Scripts/Chart.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#accountInfoModal").on("show.bs.modal", function () {
                $.ajax({
                    url: "/api/moneytransfer/metadata",
                    dataType: "json",
                    method: "GET",
                    success: function (metadata) {
                        $("#js-transfers-sent").html(metadata.transfersSent);
                        $("#js-transfers-received").html(metadata.transfersReceived);
                        $("#js-total-money-sent").html(metadata.totalMoneySent);
                        $("#js-total-money-received").html(metadata.totalMoneyReceived);


                        var chartCanvas = $("#js-transfer-chart");
                        var chart = new Chart(chartCanvas, {
                            type: "doughnut",
                            data: {
                                labels: ["Money sent (PLN)", "Money received (PLN)"],
                                datasets: [{
                                    data: [metadata.totalMoneySent, metadata.totalMoneyReceived],
                                    backgroundColor: ['rgba(114, 28, 36, 1)', 'rgba(21, 87, 36, 1)'],
                                    borderWidth: 2
                                }]
                            },
                            options: {
                                animation: {
                                    animateRotate: true
                                },
                                responsive: false
                            }
                        });
                    }
                })
            });
        });
    </script>

}