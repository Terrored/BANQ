
@{
    ViewBag.Title = "Calculator";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row mt-3 justify-content-center">
    <div class="col-4">
        <div class="container jumbotron px-4 mb-0 pb-3 visibility3">
            <div class="text-center">
                <h4>Calculate credit contidions that fit your needs</h4>
            </div>
            <hr />
            <div class="input-group">
                <input type="text" id="creditAmount" placeholder="Credit Amount" class="form-control" />
                <div class="input-group-append">
                    <span class="input-group-text">PLN</span>
                </div>
            </div>

            <div class="input-group my-3">
                <input type="text" id="percentageRate" placeholder="Percentage rate" class="form-control" />
                <div class="input-group-append">
                    <span class="input-group-text">%</span>
                </div>
            </div>

            <div class="input-group my-3">
                <label>Credit period</label>
                <input type="range" class="custom-range" id="creditPeriod" min="1" max="20" step="1" />
                <label id="creditPeriodInfo">year(s)</label>
            </div>
            <button type="button" id="calculate" class="btn btn-primary btn-block">Calculate</button>

            <hr />

            <div class="alert alert-success text-center">
                <span id="installmentCount" class="font-weight-bold"></span> 
                total installments 
                <span id="installmentAmount" class="font-weight-bold"></span> PLN each. <br />
                <span id="totalMoney" class="font-weight-bold"></span> PLN in total.
 
            </div>  
        </div>
    </div>
</div>

@section scripts
{

    <script>
        $(document).ready(function () {

            (function ($) {
                $.fn.inputFilter = function (inputFilter) {
                    return this.on("input keydown keyup mousedown mouseup select contextmenu drop", function () {
                        if (inputFilter(this.value)) {
                            this.oldValue = this.value;
                            this.oldSelectionStart = this.selectionStart;
                            this.oldSelectionEnd = this.selectionEnd;
                        } else if (this.hasOwnProperty("oldValue")) {
                            this.value = this.oldValue;
                            this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                        }
                    });
                };
            }(jQuery));

            var getYearSpelling = function (value) {
                if (value == 1)
                    return " year";
                else
                    return " years";
            }

            $(".alert").hide();

            var currentPeriod = $("#creditPeriod").val();
            $("#creditPeriodInfo").html(currentPeriod + getYearSpelling(currentPeriod));

            $("#creditAmount").inputFilter(function (value) {
                return /^\d*$/.test(value);
            });

            $("#percentageRate").inputFilter(function (value) {
                return /^-?\d*[.,]?\d{0,2}$/.test(value);
            });

            $("#creditPeriod").on("input", function () {
                var creditPeriod = $(this).val();
                $("#creditPeriodInfo").html(creditPeriod + getYearSpelling(creditPeriod));
            });

            $("input").on("input", function () {
                $(".alert").slideUp();
            });

            $("#calculate").on("click", function () {
                var percentageRate = parseFloat($("#percentageRate").val());
                var creditAmount = parseInt($("#creditAmount").val(), 10);
                var installmentCount = $("#creditPeriod").val() * 12;

                var q = ((percentageRate / 100) / 12) + 1;

                var helper = Math.pow(q, installmentCount);
                var installment = creditAmount * helper * (q - 1) / (helper - 1);


                $(".alert").slideDown();

                $("#installmentCount").html(installmentCount);
                $("#installmentAmount").html(installment.toFixed(2).toString().replace(".", ","));
                $("#totalMoney").html((installment * installmentCount).toFixed(0).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1 '));
            });
        });
    </script>

}
